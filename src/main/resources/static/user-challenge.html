<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Jun Yin Captcha Tool</title>

    <!-- jQuery from CDN -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Bootstrap CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>

        h2 {
            background: linear-gradient(to right, #76dc5a, #80ead6);
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .success {
            border: 2px solid green;
            animation: successAnimation 1s;
        }

        @keyframes successAnimation {
            0% { background-color: transparent; }
            100% { background-color: lightgreen; }
        }

        .failure {
            border: 2px solid red;
            animation: failureAnimation 1s;
        }

        @keyframes failureAnimation {
            0% { background-color: transparent; }
            100% { background-color: lightcoral; }
        }

    </style>
</head>

<body>
    <div class="container mt-5">
        <h2>User Captcha Challenge</h2>
        <form id="loginForm">
            <!--
            <div class="form-group mb-3" >
                <label for="loginId" style="margin-top:10px;" >Login ID</label>
                <input type="text" id="loginId" class="form-control" placeholder="Enter login ID" style="margin-top:10px;">
            </div>
            <div class="form-group mb-3">
                <label for="password" style="margin-top:10px;" >Password</label>
                <input type="password" id="password" class="form-control" placeholder="Password" style="margin-top:10px;">
            </div>
            -->

            <div class="mb-3">
                <label for="challengeType" class="form-label">Challenge Type:</label>
                <select id="challengeType" class="form-select">
                    <option value="-1" selected disabled hidden >Select Challenge Type</option>
                    <option value="0" >Single Tile</option>
                    <option value="1" >Multi Tiles</option>
                    <option value="2" >Image Typing</option>
                    <option value="3" >Image Labelling</option>
                </select>
            </div>

            <div class="form-group d-flex justify-content-center mb-3">
                <button type="button" id="requestCaptcha" class="btn btn-primary mr-2" style="margin-right:20px;">Request Captcha</button>
                <button type="button" id="requestRandomCaptcha" class="btn btn-warning">Request Random Captcha</button>
            </div>

        </form>

        <form id="validateForm">
            <div class="form-group mb-3" >
                <div id="captchaContainer" style="display: none;">
                    <img id="captchaImage" src="" alt="Captcha" class="img-responsive">
                    <p id="captchaQuestion"></p>
                </div>
            </div>

            <!-- Captcha answer input -->
            <div id="captchaAnswerContainer" class="form-group mb-3" style="margin-top:20px;">
                <label for="captchaAnswer" style="margin-top:10px;">Captcha Answer</label>
                <input type="text" id="captchaAnswer" class="form-control" placeholder="Enter captcha answer" style="margin-top:10px;">
                <button id="validateCaptcha" class="btn btn-success" style="margin-top:20px;">Submit</button>
            </div>
        </form>

    </div>

    <script>
        $(document).ready(function () {

            $('#requestCaptcha').click(function () {
                console.log("hi request captcha");

                var challengeType = document.getElementById('challengeType').value;
                var url = '/pip/challenge/request/specific'; // Your API endpoint
                if (challengeType) {
                    url += '?challengeTypeInt=' + encodeURIComponent(challengeType);
                }
                fetch(url, {
                    method: 'GET'
                }).then(response => {
                    console.log("response : " + JSON.stringify(response, null, 2));

                    // Assuming 'response' contains the necessary captcha data
                    // $('#captchaImage').attr('src', response.captchaImageUrl);
                    // $('#captchaQuestion').text(response.questionString);
                    // $('#captchaContainer').show();
                });
            });

            $('#requestRandomCaptcha').click(function () {

                fetch('/pip/challenge/request', {
                    method: 'GET'
                }).then(response => {
                    console.log("response : " + JSON.stringify(response, null, 2));

                    // Assuming 'response' contains the necessary captcha data
                    // $('#captchaImage').attr('src', response.captchaImageUrl);
                    // $('#captchaQuestion').text(response.questionString);
                    // $('#captchaContainer').show();
                });
            });

            $('#validateCaptcha').click(function () {
                // Perform AJAX request to validate captcha
                $.ajax({
                    url: '/challenge/validate', // Update with your API endpoint
                    type: 'POST',
                    data: {
                        'answer': $('#captchaAnswer').val(),
                        // Include any other necessary data
                    },
                    success: function (response) {
                        // Success effect
                        alert('Captcha validation successful!'); // Replace with a nicer effect as needed
                    },
                    error: function () {
                        // Failed effect
                        alert('Captcha validation failed. Please try again.'); // Replace with a nicer effect as needed
                    }
                });
            });

        });
    </script>
</body>